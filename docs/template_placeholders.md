# 通知テンプレートのプレースホルダ仕様

Notifier アプリの通知テンプレートの本文 (`body`) では、`{プレースホルダ名}` の形式で記述することで、Notion ページのプロパティ値やその他の動的な情報を通知メッセージに埋め込むことができます。

## 1. Notion プロパティ値のプレースホルダ

Notion データベースの各プロパティの値は、そのプロパティ名をプレースホルダとして使用することでメッセージに挿入できます。

**形式**: `{プロパティ名}`

-   `プロパティ名` の部分には、Notion データベースで設定されている実際のプロパティ名（例: 「タスク名」「担当者」「期日」など）をそのまま記述します。
-   大文字・小文字は区別されますので、Notion 上のプロパティ名と完全に一致させてください。
-   プロパティ名にスペースが含まれている場合も、そのまま `{会議名と議題}` のように記述します。

**各プロパティタイプごとの出力形式**:

以下は、`MessageFormatterServiceImpl` で現在対応している主なプロパティタイプと、そのプレースホルダがどのように文字列に変換されてメッセージに表示されるかの例です。

-   **Title (`title`)**:
    -   例: `{名前}`
    -   出力: ページのタイトル文字列 (例: `新機能Aの企画書`)
-   **Rich Text (`rich_text`)**:
    -   例: `{説明}`
    -   出力: リッチテキストのプレーンテキスト部分を結合した文字列。
-   **Number (`number`)**:
    -   例: `{進捗率}`
    -   出力: 数値 (例: `75`)。文字列として埋め込まれます。
-   **Select (`select`)**:
    -   例: `{優先度}`
    -   出力: 選択されているオプションの名前 (例: `高`)。何も選択されていない場合は空文字列。
-   **Multi-select (`multi_select`)**:
    -   例: `{タグ}`
    -   出力: 選択されている全てのオプションの名前をカンマ区切りで結合した文字列 (例: `緊急, 重要, 要確認`)。何も選択されていない場合は空文字列。
-   **Status (`status`)**:
    -   例: `{ステータス}`
    -   出力: 選択されているステータスオプションの名前 (例: `作業中`)。
-   **Checkbox (`checkbox`)**:
    -   例: `{完了フラグ}`
    -   出力: チェックが入っている場合は `✅`、入っていない場合は `⬜` の絵文字。
-   **Date (`date`)**:
    -   例: `{期日}`
    -   出力: 日付の開始時刻を `yyyy/MM/dd HH:mm` 形式でフォーマットした文字列 (例: `2025/05/23 10:00`)。もし終了時刻も設定されていれば `yyyy/MM/dd HH:mm ~ yyyy/MM/dd HH:mm` 形式 (例: `2025/05/23 10:00 ~ 2025/05/24 18:00`)。日付がない場合は空文字列。
    -   _(日付フォーマットは `date-fns` ライブラリを使用しています)_
-   **People (`people`)**:
    -   例: `{担当者}`
    -   出力: 割り当てられているユーザーの名前（もしあれば）または ID をカンマ区切りで結合した文字列 (例: `山田太郎, 佐藤花子`)。
-   **Files & media (`files`)**:
    -   例: `{添付ファイル}`
    -   出力: 添付されているファイルの名前（もしあれば）または URL をカンマ区切りで結合した文字列。
-   **URL (`url`)**:
    -   例: `{関連リンク}`
    -   出力: URL 文字列 (例: `https://example.com`)。
-   **Email (`email`)**:
    -   例: `{連絡先メール}`
    -   出力: メールアドレス文字列 (例: `test@example.com`)。
-   **Phone (`phone_number`)**:
    -   例: `{電話番号}`
    -   出力: 電話番号文字列。

**注意**:

-   上記以外のプロパティタイプ（例: `formula`, `relation`, `rollup`, `created_time`, `created_by`, `last_edited_time`, `last_edited_by`など）については、現在の `MessageFormatterServiceImpl` の実装では、`[Unhandled type: プロパティタイプ名]` と表示されるか、オブジェクトが JSON 文字列化されて表示される可能性があります。これらのプロパティタイプに対応した整形ルールは、今後の機能拡張で追加される予定です。
-   プレースホルダとして使用するプロパティ名は、通知のトリガーとなった Notion データベースに実際に存在するプロパティ名と一致している必要があります。存在しないプロパティ名を指定した場合、そのプレースホルダは空文字列または未処理のまま表示されることがあります。

## 2. 特殊プレースホルダ

Notion のプロパティ値以外に、以下の特殊なプレースホルダをメッセージ本文で使用できます。

-   **`{_pageUrl}`**:
    -   出力: 更新または作成された Notion ページの URL。
    -   例: `https://www.notion.so/your-workspace/your-page-title-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
-   **`{_databaseTitle}`**:
    -   出力: Webhook のトリガーとなった Notion データベースのタイトル。
    -   例: `プロジェクトタスク一覧`
-   **`{_now}`**:
    -   出力: 通知メッセージが整形された時点の現在日時。
    -   形式: `yyyy/MM/dd HH:mm:ss` (例: `2025/05/23 09:55:00`)
    -   _(日時のフォーマットは `date-fns` ライブラリを使用しています)_

## プレースホルダ使用例

以下は、プレースホルダを使用したメッセージ本文の例です。

```
タスク「{名前}」のステータスが「{ステータス}」に変更されました！
担当者は {担当者} さんです。
詳細は以下の URL を確認してください。
{\_pageUrl}
現在の優先度は「{優先度}」で、タグは「{タグ}」が付いています。
この通知は {\_now} に {\_databaseTitle} データベースから送信されました。
```

このテンプレートを実際のデータで整形すると、以下のようなメッセージが生成される可能性があります。

```
タスク「新機能 B の実装」のステータスが「作業中」に変更されました！
担当者は 山田太郎 さんです。
詳細は以下の URL を確認してください。
https://www.notion.so/your-workspace/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
現在の優先度は「高」で、タグは「開発, 重要」が付いています。
この通知は 2025/05/23 10:00:00 に プロジェクトタスク一覧 データベースから送信されました。
```

これらのプレースホルダを活用して、分かりやすく情報量の多い通知メッセージを作成してください。
